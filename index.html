<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Praktyczne zastosowania ESP8266</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/night.css" id="theme">
    <link rel="stylesheet" href="css/custom.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section class="title" data-background-image="img/cia-out.jpg" data-background-opacity="0.6">
          <h3 class="title">Praktyczne zastosowania ESP8266</h3>
          <p>- Maciej Małecki -</p>
          <p>- Marcin Iwanczewski -</p>
        </section>

        <section>
          <img src="img/smart-home.png">
        </section>

        <section>
          <h3 class="title">Wersje pudełkowe</h3>
          <div class="align-left">
            <div class="tiles">
              <div class="break"></div>
              <div class="img">
                <img src="img/sonoff-basic.jpg">
              </div>
              <div class="text">
                <p class="title">Sonoff Basic</p>
                <p>Zasilanie: 90-250v AC 50/60Hz</p>
                <p>Maksymalne obciążenie: 10A/2200W</p>
                <p>1 przekaźnik</p>
              </div>
              <div class="img">
                <img src="img/sonoff-basic-diy.jpg" alt="">
              </div>
              <div class="break"></div>
              <div class="img">
                <img src="img/sonoff-4ch.jpg" alt="esp-07">
              </div>
              <div class="text">
                <p class="title">Sonoff 4CH</p>
                <p>Zasilanie: 100-240V AC 50/60Hz
                <p>Maksymalne obciążenie: 10A/2200W/Przekaźnik 16A/3500W/Total</p>
                <p>4 przekaźniki</p>
                <p>Mocowanie na szynie DIN</p>
              </div>
              <div class="break"></div>
              <div class="img">
                <img src="img/sonoff-slampher.jpg" alt="esp-12s">
              </div>
              <div class="text">
                <p class="title">Sonoff Slampher</p>
                <p>Zasilanie: 90-250V</p>
                <p>Maksymalne obciążenie: 2A</p>
                <p>1 przekaźnik<p>
                <p>Sterowanie RF 433Mhz</p>
                <p>Oprawa żarówki E27<p>
              </div>
              <div class="break"></div>
              <div class="img">
                <img src="img/shelly-01.jpg">
              </div>
              <div class="text">
                <p class="title">Shelly 1</p>
                <p>Zasilanie: AC 110-230V 50/60Hz / DC 12,24-60V</p>
                <p>Maksymalne obciążenie: 16A</p>
                <p>1 przekaźnik</p>
                <p>Montaż w puszce elektrycznej</p>
              </div>
            </div>
          </div>
        </section>

        <section>
          <h3>Historia</h3>
          <div class="tiles align-left">
            <div class="img big">
              <img src="img/esp-01s.jpg" alt="ESP-01">
            </div>
            <div class="text big">
              <ul>
                <li>ESP-01 - moduł WiFi</li>
                <li>Ai-Thinker, 2014</li>
                <li>Chip: ESP 8266 - Espressif Systems</li>
              </ul>
            </div>
            <div class="break"></div>
            <div class="subtitle">Możliwości układu</div>
            <div class="break"></div>
            <div class="text">
              <ul>
                <li>WiFi i stos TCP/IP,</li>
                <li>procesor RISC 32-bit, 80MHz,</li>
                <li>pamięć RAM: 32KiB kod, 80KiB dane,</li>
              </ul>
            </div>
            <div class="text">
              <ul>
                <li>pamięć Flash: 512KiB, 1MiB, 4MiB, 16MiB - zależnie od wersji,</li>
                <li>16 GPIO, z reguły dostępne 10, 5 dostępne w pełni,</li>
                <li>jeden port ADC (rozdzielczość 10-cio bitowa).</li>
              </ul>
            </div>
            <div class="break"></div>
            <div class="subtitle">Atmel ATMEGA-328P-PU</div>
            <div class="break"></div>
            <div class="img big">
              <img src="img/640px-ATMEGA328P-PU%20(1).jpg" alt="Atmel">
            </div>
            <div class="text">
              <ul>
                <li>Procesor AVR 8-bit, 20MHz; pamięć RAM: 2KiB;</li>
                <li>pamięć Flash 32KiB; EEPROM 1KiB;</li>
                <li>23 GPIO, w tym 6 wejść ADC (10 bitów);</li>
                <li>brak wbudowanego interfejsu radiowego.</li>
              </ul>
            </div>
          </div>
        </section>
        <section>
          <h3>ESP-8266 - wyjścia</h3>
          <div class="flex">
            <img src="img/TUc96ug.png" alt="ESP-12F pinout" height="320">
            <img src="img/esp-8266-pins.png" alt="ESP 8266 Pins" height="320">
          </div>
        </section>

        <section>
          <h3>Dostępne modele (wybór)</h3>
          <div class="align-left">
            <div class="tiles">
              <div class="subtitle">Moduły Arduino/castellated</div>
              <div class="break"></div>
              <div class="img">
                <img src="img/esp-01.jpg" alt="esp-01">
              </div>
              <div class="text">
                <p class="title">ESP-01</p>
                <p>512KiB Flash, 2xGPIO, Tx, Rx</p>
              </div>
              <div class="img">
                <img src="img/esp-01s.jpg" alt="esp-01s">
              </div>
              <div class="text">
                <p class="title">ESP-01S</p>
                <p>1MiB Flash, 2xGPIO, Tx, Rx</p>
              </div>
              <div class="break"></div>
              <div class="text">
                <p class="title">ESP-07</p>
                <p>1MiB Flash, 9xGPIO, ADC, Tx, Rx</p>
                <p>Antena ceramiczna + gniazdo</p>
              </div>
              <div class="img">
                <img src="img/esp-07.png" alt="esp-07">
              </div>
              <div class="text">
                <p class="title">ESP-12F</p>
                <p>4MiB Flash, 11xGPIO, ADC, Tx, Rx</p>
                <p>Antena PCB</p>
              </div>
              <div class="img">
                <img src="img/esp-12s.png" alt="esp-12s">
              </div>

              <div class="break"></div>
              <div class="subtitle">Płytki prototypowe</div>
              <div class="break"></div>

              <div class="img">
                <img src="img/wemos-d1-mini.png" alt="wemos">
              </div>
              <div class="img">
                <img src="img/wemos-d1-mini-pro.png" alt="NodeMcuPro">
              </div>
              <div class="text">
                <p class="title">Wemos D1 Mini / Wemos D1 Mini Pro</p>
                <p>4MiB Flash (16MiB - Pro), ESP-12F (ESP8266EX - Pro), 8xGPIO, ADC, Tx, Rx</p>
                <p>Micro USB (Mini: CH340, Pro: CP2104), Reset button, Flash mode</p>
                <p>Antena PCB (Mini), Antena ceramiczna + gniazdo (Pro)</p>
              </div>
              <div class="break"></div>
              <div class="text">
                <p class="title">NodeMCU V2/V3</p>
                <p>4MiB Flash, ESP-12E, 8xGPIO, ADC, Tx, Rx</p>
                <p>Antena PCB, Micro USB (V3: CH340, V2: CP2104)</p>
                <p>Flash Button, Reset Button</p>
              </div>
              <div class="img">
                <img src="img/nodemcu-v2-v3.png" alt="NodeMcuV2V3">
              </div>
            </div>
          </div>
        </section>

        <section>
          <h3>Co kupić?</h3>
          <div class="r-hstack">
            <div>
              <img src="img/wemos-d1-streight.png" alt="Wemos">
              <p class="smaller">Wemos D1 Mini</p>
            </div>
            <div>
              <img src="img/esp-12s.png" alt="esp-12s">
              <p class="smaller">ESP-12F/S</p>
            </div>
            <div>
              <img src="img/esp-12s-breakout.png" alt="esp-12s breakout">
              <p class="smaller">Breakout</p>
            </div>
          </div>
        </section>

        <section>
          <h2>Flashowanie</h2>
          <div class="tiles align-left">
            <div class="img big">
              <img src="img/wemos-d1-streight.png" alt="wemos">
            </div>
            <div class="text big">
              <p class="title">Flashowanie przez USB:</p>
              <p>automatyczny flash-mode + reset</p>
            </div>
            <div class="break"></div>
            <div class="text big">
              <p class="title">Flashowanie przez Tx/Rx (serial):</p>
              <ul>
                <li>wymagają odpowiedniej konfiguracji pinów,</li>
                <li>najlepiej zbudować programator.</li>
              </ul>
            </div>
            <div class="img big">
              <img src="img/esp-programmer.png" alt="esp programmer">
            </div>
          </div>
        </section>
        <section>
          <h3 class="title">Flashowanie ESP-XX</h3>
          <!--TODO: Fix layout (Marcin)-->
          <div class="align-left">
              <p>Sonoff Basic PINy</p>
              <img src="img/sonoff-basic-flashing.jpg" class="align-left" height="250">
              <p class="title">USB-Serial Konverter (CH341)</p>
              <img src="img/ch341.jpg" class="align-left" height="200">
          </div>
        </section>

        <section>
          <h2>Firmware</h2>
          <ul>
            <li>(AT)</li>
            <li>(NodeMCU)</li>
            <li class="other-color">ESP Easy</li>
            <li class="other-color-2">Tasmota</li>
          </ul>
        </section>
        <!--
         TODO (Marcin) -> część 2
        <section>
            <h2>NodeMcu</h2>
            <img src="img/nodemcu-logo.png">
        </section>
        <section>
          <h3>NodeMCU cloud bilder</h3>
          <a href="https://nodemcu-build.com/">
            <img src="img/nodemcu-cloudbuilder.png" height="550">
          </a>
        </section>
        <section>
          <section>
            <img src="img/luaa.gif">
          </section>
          <section>
            <h3>Web REST Server</h3>
            <pre><code data-trim data-noescape style="font-size: 0.5em;">
              srv=net.createServer(net.TCP)
              srv:listen(80, function(conn)
                conn:on("receive", function(client, request)
                  local response
                  local requestMap = getRequestMap(request)
                  if (requestMap == nil) then
                    response = BAD_REQUEST
                  elseif (requestMap.method == "OPTIONS") then
                    response = getAuthCORDHeader(requestMap.origin)
                  elseif (requestMap.method == "GET") then
                    response = getGPIOStatus(requestMap)
                  elseif (requestMap.method == "PUT") then
                    response = setGPIOFromRequestPath(requestMap)
                  end
                  conn:send(response)
                  conn:close()
                  collectgarbage()
                  end)
              end)
            </code></pre>
          </section>
        </section>
          -->

        <section>
          <h2>ESP Easy</h2>
          <section>
            <img src="img/esp-easy/lets-control-it.png" alt="LetsControllIt">
          </section>
          <section>
            <div class="align-left">
              <p>Stara dokumentacja:</p>
              <a href="https://www.letscontrolit.com/wiki/index.php/Main_Page">https://www.letscontrolit.com/wiki/index.php/Main_Page</a>
              <p>Nowa dokumentacja:</p>
              <a href="https://espeasy.readthedocs.io/en/latest/">https://espeasy.readthedocs.io/en/latest/</a>
            </div>
          </section>
          <section>
            <h3 class="other-color-2">Najważniejsze funkcjonalności:</h3>
            <div class="align-left other-color">
              <ul>
                <li>interfejs webowy,</li>
                <li>konfiguracja połączenia z max. 2 sieciami WiFi,</li>
                <li>tryb Access Point,</li>
                <li>obsługa wielu rodzajów czujników,</li>
                <li>obsługa P2P, REST, MQTT,</li>
                <li>wbudowany interpreter języka skryptowego,</li>
                <li>obsługa trybu głebokiego uśpienia.</li>
              </ul>
            </div>
          </section>
        </section>
        <section>
          <h2>ESP Easy - flashowanie</h2>
          <section>
            <p class="align-left smaller">Pakiet instalacyjny oprócz obrazów i źródeł, zawiera także niezbędne
              oprogramowanie dla systemu Windows.</p>
            <img src="img/esp-easy/esp-easy-flashing-1.png" alt="Flashing 1">
          </section>
          <section>
            <img src="img/esp-easy/esp-easy-flashing-2.png" alt="Flashing 2">
            <div class="align-left smaller">
              <ul>
                <li><code>_1M.bin</code> - dla modułów z 1MiB Flash,</li>
                <li><code>_4M1M.bin</code> - dla modułów z 4MiB Flash,</li>
                <li><code>blank_xxx.bin</code> - gdy coś pójdzie źle,</li>
                <li><code>_VCC.bin</code> - obsługa mierzenia VCC z użyciem ADC.</li>
              </ul>
            </div>
          </section>
          <section>
            <p>Pierwsze uruchomienie (AP)</p>
            <div class="r-hstack">
              <img src="img/esp-easy/easy-config-1.png" alt="Config 1">
              <img src="img/esp-easy/easy-config-2.png" alt="Config 2">
              <img src="img/esp-easy/easy-config-3.png" alt="Config 3">
            </div>
          </section>
          <section>
            <p>Pierwsze uruchomienie (AP)</p>
            <img src="img/esp-easy/easy-config-4.png" alt="Config 4" height="400">
          </section>
        </section>
        <section>
          <h3>ESP Easy - interfejs webowy</h3>
          <section>
            <img src="img/esp-easy/esp-easy-main.png" alt="ESP Easy Main" width="700">
          </section>
        </section>
        <section>
          <h3>Stacja pogodowa</h3>
          <section>
            <h4>ESP Easy i czujnik BME280</h4>
            <img src="img/esp-easy/esp-easy-weather-breadboard.png" alt="weather" height="400">
          </section>
          <section>
            <h4>Konfiguracja interfejsu I2C</h4>
            <img src="img/esp-easy/weather-i2c.png" alt="i2c" height="400">
          </section>
          <section>
            <h4>Konfiguracja urządzenia</h4>
            <img src="img/esp-easy/weather-device.png" alt="device" height="400">
          </section>
          <section>
            <h4>Sprawdzenie odczytów</h4>
            <img src="img/esp-easy/weather-readouts.png" alt="readouts" height="400">
          </section>
          <section>
            <h2>MQTT?</h2>
          </section>
          <section>
            <img src="img/esp-easy/esp-easy-controllers.png" alt="controllers" height="450">
          </section>
          <section>
            <img src="img/esp-easy/weather-mqtt-1.png" alt="mqtt1" height="450">
          </section>
          <section>
            <img src="img/esp-easy/weather-mqtt-2.png" alt="mqtt2" height="450">
          </section>
          <section>
            <img src="img/esp-easy/weather-publish.png" alt="publish" height="450">
          </section>
          <section>
            <img src="img/esp-easy/weather-hass.png" alt="publish" height="450">
          </section>
        </section>
        <section>
          <a href="https://tasmota.github.io/docs/About/">
            <img src="img/tasmota.png" width="900">
          </a>
          <aside class="notes">
            Krótko o Historii Tasmoty: Sonoff, MQTT Hack, Tanio ;)
          </aside>
        </section>
          <section>
            <h3>Tasmota - flashowanie</h3>
            <div class="flex" style="background-color: rgba(0, 0, 0, 0.9); color: #fff; padding: 10pt;">
              <h5>NIE PRÓBUJ FLASHOWAĆ URZĄDZEŃ PODŁĄCZONYCH DO SIECI 230V!</h5>
              <img src="img/high_voltage_warning.svg" width="150">
            </div>
            <ul>
              <li>Tasmotizer</li>
              <li>Tasmota PyFlasher</li>
              <li>NodeMCU PyFlasher</li>
              <a href="https://github.com/espressif/esptool">
                <li>Esptool.py</li>
              </a>
              <li>Esptool executable</li>
            </ul>
          </section>
          <section>
            <h3>Drivery (Linux)</h3>
            <img src="img/ch341-linux-module.png">
          </section>
          <section>
            <h4>esptool.py</h4>
            <!-- TODO (Maciek) plugin do kodu albo zwiększyć obszar -->
            <pre><code>esptool.py --port /dev/ttyUSB0 read_flash 0x00000 0x100000 image1M.bin</code></pre>
            <pre><code>esptool.py --port /dev/ttyUSB0 erase_flash</code></pre>
            <pre><code>esptool.py --port /dev/ttyUSB0 write_flash -fm dout 0x0 tasmota.bin</code></pre>
            <!--
            <a>flash_mode</a>
            <table style="font-size: 25px;">
              <thead>
                <tr>
                  <th>Option</th>
                  <th>Mode Name</th>
                  <th>Pins Used</th>
                  <th>Speed (ESP8266 & ESP32)</th>
                </tr><tr>
                </thead>
                <tbody>
                  <td>qio</td>
                  <td>Quad I/O</td>
                  <td>4 pins used for address & data</td>
                  <td>Fastest</td>
                </tr><tr>
                  <td>qout</td>
                  <td>Quad Output</td>
                  <td>4 pins used for data</td>
                  <td>Approx 15% slower than qio</td>
                </tr><tr>
                  <td>dio</td>
                  <td>Dual I/O</td>
                  <td>2 pins used for address & data</td>
                  <td>Approx 45% slower than qio</td>
                </tr><tr>
                  <td>dout</td>
                  <td>Dual Output</td>
                  <td>2 pins used for data</td>
                  <td>Approx 50% slower than qio</td>
                </tr>
                </tbody>
            </table>
            -->
          </section>
        </section>
        <!--
        <section>
          Tasmota - screen z telefonu (wifi) 
        </section>
        -->
        <section>
          <h4>Tasmota - konfiguracja połaczenia WIFI</h4>
          <img src="img/tasmota-wifi.png" height="600">
        </section>
        <section>
          <h3>Detektor ruchu w ESP</h3>
          <img src="img/ESP-PIR_bb.png">
        </section>
        <section>
          <h4>Tasmota - konfiguracja detektora ruchu</h4>
          <img src="img/tasmota-pir.png" height="600">
        </section>
        <section>
          <h4>Tasmota MQTT</h4>
          <img src="img/tasmota-mqtt.png" height="600">
        </section>
        <section>
          <h4>Tasmota - reakcja na ruch (Rule)</h4>
          <!-- TODO (Marcin) połam kod -->
          <pre><code data-trim data-noescape style="font-size: 0.5em;">
            SwitchMode1 1
            SwitchTopic 0
            Rule1 
              ON Switch1#state=1 do publish stat/tasmota_0F93E7/PIR1 ON ENDON 
              ON Switch1#state=0 do publish stat/tasmota_0F93E7/PIR1 OFF ENDON
            Rule1 1
          </code></pre>
        </section>
        <section>
          <img src="img/mosquitto.png" width="600">
          <p>Odbieranie wiadomości od Tasmoty</p>
          <pre><code data-trim data-noescape style="font-size: 0.5em;">
            mosquitto_sub -h HOST -t TOPIC -p PORT
          </code></pre>
        </section>
        <section>
          <h4>Pomiar PM2.5 w ESP</h4>
          <img src="img/ESP-PMS_bb.png" height="600">
        </section>
        <section>
          <h4>Tasmota - konfiguracja PMS7003</h4>
          <img src="img/tasmota-pms.png" height="600">
        </section>
        <section>
          <h4>Tasmota wizualizacja pomiarów PM</h4>
          <img src="img/tasmota-PMS-results.png" height="600">
        </section>

        <!-- Slajd końcowy -->
        <section>
          <h2>Q&A</h2>
          <img src="img/qr-part-1.png" alt="qr">
          <p>
            <a href="https://wania.github.io/ESP8266-InPractice/">https://wania.github.io/ESP8266-InPractice/</a>
          </p>
        </section>
      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,
        history: true,
        slideNumber: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes],
      });
    </script>
  </body>
</html>
